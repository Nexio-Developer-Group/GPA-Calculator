<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA CAL BY NEXIO DEV</title>
    <link rel="icon" type="image/png" href="Logo.png">
    <!-- Bootstrap 5 & Animate.css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #ffecd2, #ffc37f);
            color: #333;
        }
        
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #ffecd2, #fab15e);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(15px);
            text-align: center;
            color: #333;
            cursor: pointer;
        }
         
        
        .step {
            margin-top: 100px;
            display: none;
            padding: 20px;
            text-align: center;
        }
        .step.show {
            display: block;
        }
        
        .selection-button {
            background-color: #ffb968;
            border: none;
            color: black;
            padding: 15px 30px;
            font-size: 1.2em;
            margin: 70px;
            cursor: pointer;
            border-radius: 25px;
            transition: background 0.3s ease;
        }
        .selection-button:hover {
            background-color: #ebac5b;
        }
        
        .table-container {
            margin: 20px auto;
            width: 80%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 2px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f3c061;
            color: rgb(2, 2, 2);
        }
        
        .grade-input {
            width: 96%;
            background: transparent;
            border: none; 
            padding: 10px;
            font-size: 1.2em;
            text-align: center;
        }
        
        #optional-subjects {
            width: 80%;
            margin: 20px auto;
            text-align: left;
        }
        
        #apply-button {
            background-color: #ff8000;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #apply-button:hover {
            background-color: #e67300;
        }
        
        .back-arrow {
            position: absolute;
            border: none;
            top: 20px;
            left: 20px;
            font-size: 2em;
            cursor: pointer;
            background: transparent;
        }
        
        #cgpa-result {
            font-size: 10em;
            font-weight: bold;
            margin-top: 10px;
            color: rgb(11, 12, 11);
        }
    </style>
</head>
<body>
    <div id="welcome-screen">
        <div id="welcome-message">
            <h1 style="font-size: 50px;">Welcome to GPA Calculator</h1>
             
        
        </div>
    </div>

    <!-- Semester Selection -->
    <div class="mb-3">
        <label for="semester" class="form-label">Select Semester:</label>
        <select id="semester" class="form-select" disabled onchange="fetchSubjects()">
            <option value="">-- Select Semester --</option>
        </select>
    </div>

    <!-- Subjects Table -->
    <h3>Subjects & Grade Input</h3>
    <table class="table table-bordered text-center">
        <thead class="table-dark">
            <tr>
                <th>Subject</th>
                <th>Credits</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody id="subject-table"></tbody>
    </table>

    <!-- Optional Subjects -->
    <h3>Select Optional Subjects</h3>
    <div class="scrollable-container mb-3">
        <div id="optional-subjects"></div>
    </div>
  
    
    <script>
        document.getElementById('welcome-screen').addEventListener('click', function() {
            this.style.display = 'none';
            document.getElementById('content').classList.add('show');
            fetchUBPM();
        });

        function previousStep(currentStep) {
            document.getElementById(`${currentStep}-step`).classList.remove('show');
            let prevStep = {
                'program': 'department',
                'minor': 'program',
                'semester': 'minor',
                'subject': 'semester',
                'cgpa': 'subject'
            }[currentStep];
            document.getElementById(`${prevStep}-step`).classList.add('show');
        }
         
        
        let selectedDepartment = null;
        let selectedProgram = null;
        let selectedMinor = null;
        let selectedSemester = null;
        let selectedUBPMID = null;
        let ubpmData = [];
        let subjects = [];
        let optionalSubjects = [];
        const gradePointsMap = {
            "O": 10,
            "A+": 9,
            "A": 8,
            "B+": 7,
            "B": 6,
            "C": 5,
            "F": 0
        };

    function fetchUBPM() {
        fetch('http://localhost:5000/api/ubpm')
            .then(response => response.json())
            .then(data => {
                const ubpmDropdown = document.getElementById("ubpm");
                data.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item.UBPM_ID;
                    option.textContent = `${item.department} - ${item.program} (${item.minor || "No Minor"})`;
                    ubpmDropdown.appendChild(option);
                });
            });
    }

    function enableSemesterSelection() {
        selectedUBPM_ID = document.getElementById("ubpm").value;
        document.getElementById("semester").disabled = !selectedUBPM_ID;
    }

    function populateSemesters() {
        const semesterDropdown = document.getElementById("semester");
        for (let i = 1; i <= 8; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = `Semester ${i}`;
            semesterDropdown.appendChild(option);
        }
    }

    function fetchSubjects() {
        const semester = document.getElementById("semester").value;
        if (!selectedUBPM_ID || !semester) return;

        fetch(`http://localhost:5000/api/subjects/${selectedUBPM_ID}/${semester}`)
            .then(response => response.json())
            .then(data => {
                subjects = data;
                updateSubjectTable("subject-table", subjects);
            });
        }

    function fetchOptionalSubjects() {
        fetch('http://localhost:5000/api/opt-subjects')
            .then(response => response.json())
            .then(data => {
                const optionalSubjectsDiv = document.getElementById("optional-subjects");
                optionalSubjectsDiv.innerHTML = "";
                data.forEach(subject => {
                    const div = document.createElement("div");
                    div.classList.add("form-check");

                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.value = JSON.stringify(subject);
                        checkbox.name = "optionalSubject";

                    const label = document.createElement("label");
                    label.className = "form-check-label";
                    label.textContent = subject.subject_name;

                    div.appendChild(checkbox);
                    div.appendChild(label);
                    optionalSubjectsDiv.appendChild(div);
                });
            });
    }

    function addOptionalSubjects() {
        const checkboxes = document.querySelectorAll('input[name="optionalSubject"]:checked');
        optionalSubjects = [];
        checkboxes.forEach(checkbox => {
            optionalSubjects.push(JSON.parse(checkbox.value));
        });
        updateSubjectTable("optional-subject-table", optionalSubjects);
    }

            optionalSubjects.forEach(subject => {
                const row = document.createElement("tr");
                const nameCell = document.createElement("td");
                const creditCell = document.createElement("td");
                const gradeCell = document.createElement("td");

                nameCell.textContent = subject.subject_name;
                creditCell.textContent = subject.subject_cred;

                const gradeInput = document.createElement("input");
                gradeInput.type = "text";
                gradeInput.classList.add("grade-input");
                gradeCell.appendChild(gradeInput);

                row.appendChild(nameCell);
                row.appendChild(creditCell);
                row.appendChild(gradeCell);
                tableBody.appendChild(row);
            });
        }

        // Calculate CGPA
        function calculateCGPA() {
            const gradeInputs = document.querySelectorAll(".grade-input");
            let totalPoints = 0;
            let totalCredits = 0;

            [...subjects, ...optionalSubjects].forEach((subject, index) => {
                const grade = gradeInputs[index].value;
                if (grade) {
                    const gradePoints = gradePointsMap[grade.toUpperCase()] || 0;
                    totalPoints += gradePoints * subject.subject_cred;
                    totalCredits += subject.subject_cred;
                }
            });

            const cgpa = totalCredits ? (totalPoints / totalCredits).toFixed(4) : 0;
            document.getElementById("cgpa-result").textContent = `${cgpa}`;
        }
    </script>
</body>
</html>
